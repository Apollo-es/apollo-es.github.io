{% unless item.oculto %}
{% assign card_categories = item.categoria | default: '' %}
{% assign is_game = false %}
{% if item.categoria and item.categoria contains 'juegos' %}
  {% assign is_game = true %}
{% endif %}
{% assign card_tags = item.hashtags | default: '' %}
<article class="card"
         data-id="{{ item.id }}"
         data-cats="{% if card_categories %}{{ card_categories | join: ',' | escape }}{% endif %}"
         data-title="{{ item.titulo | escape }}"
         data-desc="{{ item.descripcion | strip_html | strip_newlines | escape }}"
         data-clicks="{{ item.interacciones | default: 0 }}"
         data-searches="{{ item.busquedas | default: 0 }}"
         {% if card_tags %}data-tags="{{ card_tags | join: ' ' | escape }}"{% endif %}
         {% if item.licencia %}data-licencia="{{ item.licencia | escape }}"{% endif %}
         {% if item.consola %}data-console="{{ item.consola | escape }}"{% endif %}
         {% if item.desarrolladora %}data-developer="{{ item.desarrolladora | escape }}"{% endif %}
         {% if item.genero %}data-genre="{{ item.genero | escape }}"{% endif %}
         {% if item.fecha_publicacion %}data-published="{{ item.fecha_publicacion }}"{% endif %}>
  <div class="card-glow"></div>
  <div class="card-body">
    <h3 class="card-title">{{ item.titulo }}</h3>

    {% assign cover_path = item.portada %}
    {% if cover_path == nil or cover_path == '' %}
      {% assign cover_path = '/static/juegos/' | append: item.id | append: '.png' %}
    {% endif %}

    {% assign cover_url = '' %}
    {% assign cover_path = cover_path | append: '' | strip %}
    {% if cover_path != '' %}
      {% assign cover_prefix = cover_path | slice: 0,5 %}
      {% if cover_path contains '://' or cover_prefix == 'data:' %}
        {% assign cover_url = cover_path %}
      {% else %}
        {% assign cover_url = cover_path | relative_url %}
      {% endif %}
      <img class="card-cover"
           src="{{ cover_url | escape }}"
           alt="Portada de {{ item.titulo }}"
           loading="lazy"
           onerror="this.remove();">
    {% endif %}

    <p class="card-desc">{{ item.descripcion }}</p>
    <div class="meta">
      <span class="chip">{{ item.tipo | upcase }}</span>
      <span class="chip">{{ item.idioma | upcase }}</span>
      <span class="chip">{{ item.tamano }}</span>
      {% if item.consola %}<span class="chip chip-soft">{{ item.consola }}</span>{% endif %}
      {% if item.desarrolladora %}<span class="chip chip-soft">{{ item.desarrolladora }}</span>{% endif %}
      {% if item.genero %}<span class="chip chip-soft">{{ item.genero }}</span>{% endif %}
    </div>

    {% if is_game %}
      {% assign detail_url = '/juegos/' | append: item.id | append: '/' | relative_url %}
      <div class="card-actions">
        <a class="btn primary" href="{{ detail_url }}">
          <i class="ti ti-device-gamepad-2"></i> Ver ficha completa
        </a>
        <button class="btn alt report-count-btn"
                type="button"
                data-report-counter="{{ item.id }}">
          <i class="ti ti-flag"></i> Reportes (<span data-report-total>0</span>)
        </button>
      </div>
    {% elsif item.descargas %}
      <div class="downloads">
        {% for descarga in item.descargas %}
          <section class="download-group">
            {% if descarga.titulo %}
              <h4 class="download-title">{{ descarga.titulo }}</h4>
            {% endif %}

            <div class="mirrors">
              {% for m in descarga.mirrors %}
                {% assign mirror_url = m.url | default: '' | strip %}
                {% assign has_url = mirror_url != '' %}
                <div class="mirror-entry">
                  {% if has_url %}
                  <a class="btn dl"
                     href="{{ mirror_url }}"
                     target="_blank"
                     rel="nofollow noopener">
                    <i class="ti ti-download"></i> Descargar en {{ m.host }}
                  </a>
                  <button class="report-flag"
                          type="button"
                          data-item="{{ item.id }}"
                          data-title="{{ item.titulo }}"
                          data-group="{{ descarga.titulo | default: 'Descarga' }}"
                          data-host="{{ m.host }}"
                          data-url="{{ mirror_url }}"
                          title="Reportar enlace caído">
                    <i class="ti ti-alert-triangle" aria-hidden="true"></i>
                    <span class="sr-only">Reportar enlace caído</span>
                  </button>
                  {% else %}
                  <button class="btn dl disabled" type="button" disabled>
                    <i class="ti ti-clock"></i> {{ m.estado | default: 'Enlace disponible próximamente' }}{% if m.host %} · {{ m.host }}{% endif %}
                  </button>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          </section>
        {% endfor %}
      </div>
    {% elsif item.mirrors %}
      <div class="mirrors">
        {% for m in item.mirrors %}
          {% if m.url %}
            <div class="mirror-entry">
              <a class="btn dl"
                 href="{{ m.url | strip }}"
                 target="_blank"
                 rel="nofollow noopener">
                <i class="ti ti-download"></i> Descargar en {{ m.host }}
              </a>
              <button class="report-flag"
                      type="button"
                      data-item="{{ item.id }}"
                      data-title="{{ item.titulo }}"
                      data-group="Descarga"
                      data-host="{{ m.host }}"
                      data-url="{{ m.url | strip }}"
                      title="Reportar enlace caído">
                <i class="ti ti-alert-triangle" aria-hidden="true"></i>
                <span class="sr-only">Reportar enlace caído</span>
              </button>
            </div>
          {% endif %}
        {% endfor %}

        <div class="direct-links">
          {% for m in item.mirrors %}
            <a class="btn alt hidden" href="{{ m.url | escape }}" target="_blank" rel="noopener">
              <i class="ti ti-external-link"></i> Directo: {{ m.host }}
            </a>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% if item.disclaimer %}
      {% unless is_game %}
        <p class="legal-disclaimer">{{ item.disclaimer }}</p>
      {% endunless %}
    {% endif %}

    {% if item.categoria contains 'juegos' %}
      {% assign hashtags = item.hashtags %}
      {% if hashtags and hashtags.size > 0 %}
        <p class="seo-tags sr-only">{{ hashtags | join: ' ' }}</p>
      {% else %}
        <p class="seo-tags sr-only">#{{ item.titulo | slugify: 'latin' | replace: '-', '' }} #DescargarJuegos #MegaMediafireDrive</p>
      {% endif %}
    {% endif %}
  </div>
</article>
{% endunless %}
